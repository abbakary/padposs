{% load tz %}
{% load date_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Car Service Tracking System - Manage your auto service business efficiently">
    <meta name="keywords" content="car service, auto repair, vehicle maintenance, service tracking, auto shop">
    <meta name="author" content="Superdoll">
    
    <!-- Favicon -->
    <link rel="icon" href="{% static 'assets/images/favicon.png' %}" type="image/x-icon">
    <link rel="shortcut icon" href="{% static 'assets/images/favicon.png' %}" type="image/x-icon">
    
    <title>{% block title %}POS Tracker{% endblock %}</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Vendor CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/fonts/fontawesome-webfont.woff2' %}">
    <link rel="stylesheet" href="{% static 'fonts/themify.woff/themify.woff' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/icofont.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/themify-icons@1.0.1/css/themify-icons.css">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/flag-icon.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/feather-icon.css' %}">
    
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/vendors/slick.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/slick-theme.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/scrollbar.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/animate.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/echart.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/date-picker.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/datatables.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendors/select2.css' %}">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/vendors/bootstrap.css' %}">
    
    <!-- App CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link id="color" rel="stylesheet" href="{% static 'assets/css/color-1.css' %}" media="screen">
    
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/responsive.css' %}">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/custom.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/tz-phone.css' %}">

    <!-- Timezone Detection -->
    <script>
        if (!document.cookie.split('; ').find(row => row.startsWith('django_timezone'))) {
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const expires = new Date();
            expires.setTime(expires.getTime() + (365 * 24 * 60 * 60 * 1000));
            document.cookie = `django_timezone=${encodeURIComponent(timezone)};expires=${expires.toUTCString()};path=/`;
            window.location.reload();
        }
    </script>
    
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- loader starts-->
    <div class="loader-wrapper">
        <div class="loader">
            <div class="loader4"></div>
        </div>
    </div>
    <!-- loader ends-->
    
    <!-- tap on top starts-->
    <div class="tap-top">
        <i data-feather="chevrons-up"></i>
    </div>
    <!-- tap on tap ends-->
    
    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
        <!-- Page Header Start-->
        <div class="page-header">
            <div class="header-wrapper row m-0">
                <!-- Search Form -->
                <form class="form-inline search-full col" action="#" method="get">
                    <div class="form-group w-100">
                        <div class="Typeahead Typeahead--twitterUsers">
                            <div class="u-posRelative">
                                <input class="demo-input Typeahead-input form-control-plaintext w-100" 
                                       type="text" placeholder="Search Pos .." name="q" title="" autofocus>
                                <div class="spinner-border Typeahead-spinner" role="status">
                                    <span class="sr-only">Loading... </span>
                                </div>
                                <i class="close-search" data-feather="x"></i>
                            </div>
                            <div class="Typeahead-menu"></div>
                        </div>
                    </div>
                </form>
                
                <!-- Logo -->
                <div class="header-logo-wrapper col-auto p-0">
                    <div class="logo-wrapper">
                        <a href="{% url 'tracker:dashboard' %}">
                            <img class="img-fluid for-light" src="{% static 'assets/images/logo/logo_dark.png' %}" alt="logo-light">
                            <img class="img-fluid for-dark" src="{% static 'assets/images/logo/logo.png' %}" alt="logo-dark">
                        </a>
                    </div>
                    <div class="toggle-sidebar">
                        <i class="status_toggle middle sidebar-toggle" data-feather="align-center"></i>
                    </div>
                </div>
                
                <!-- Welcome Message -->
                <div class="left-header col-xxl-5 col-xl-6 col-lg-5 col-md-4 col-sm-3 p-0">
                    <div>
                        <a class="toggle-sidebar" href="#">
                            <i class="iconly-Category icli"></i>
                        </a>
                        <div class="d-flex align-items-center gap-2">
                            <h4 class="f-w-600">Welcome <span style="color: blue;">{{user.username}}</span></h4>
                            <img class="mt-0" src="{% static 'assets/images/hand.gif' %}" alt="hand-gif">
                        </div>
                    </div>
                    <div class="welcome-content d-xl-block d-none">
                        <span class="text-truncate col-12">Here's what's happening with your store today.</span>
                    </div>
                </div>
                
                <!-- Right Navigation -->
                <div class="nav-right col-xxl-7 col-xl-6 col-md-7 col-8 pull-right right-header p-0 ms-auto">
                    <ul class="nav-menus">
                        <!-- Search -->
                        <li class="d-md-block d-none">
                            <div class="form search-form mb-0">
                                <div class="input-group">
                                    <span class="input-icon">
                                        <svg>
                                            <use href="{% static 'assets/svg/icon-sprite.svg' %}#search-header"></use>
                                        </svg>
                                        <input class="w-100" type="search" placeholder="Search">
                                    </span>
                                </div>
                            </div>
                        </li>
                        
                        <!-- Mobile Search -->
                        <li class="d-md-none d-block">
                            <div class="form search-form mb-0">
                                <div class="input-group">
                                    <span class="input-show">
                                        <svg id="searchIcon">
                                            <use href="{% static 'assets/svg/icon-sprite.svg' %}#search-header"></use>
                                        </svg>
                                        <div id="searchInput">
                                            <input type="search" placeholder="Search">
                                        </div>
                                    </span>
                                </div>
                            </div>
                        </li>
                        
                        <!-- Bookmark -->
                        <li class="onhover-dropdown">
                            <svg>
                                <use href="{% static 'assets/svg/icon-sprite.svg' %}#star"></use>
                            </svg>
                            <div class="onhover-show-div bookmark-flip">
                                <div class="flip-card">
                                    <div class="flip-card-inner">
                                        <div class="front">
                                            <h6 class="f-18 mb-0 dropdown-title">Bookmark</h6>
                                        </div>
                                        <div class="back">
                                            <ul>
                                                <li>
                                                    <div class="bookmark-dropdown flip-back-content">
                                                        <input type="text" placeholder="search...">
                                                    </div>
                                                </li>
                                                <li>
                                                    <a class="f-w-700 d-block flip-back" id="flip-back" href="javascript:void(0)">Back</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        
                        <!-- Dark Mode Toggle -->
                        <li>
                            <div class="mode">
                                <i class="moon" data-feather="moon"></i>
                            </div>
                        </li>
                        
                        <!-- Notifications -->
                        <li class="onhover-dropdown notification-down">
                            <div class="notification-box">
                                <i data-feather="bell"></i>
                                {% with today_visitors=today_visitors|default:0 low_stock_items=low_stock_items|default:0 overdue_orders=overdue_orders|default:0 %}
                                    {% with total_notifications=today_visitors|add:low_stock_items|add:overdue_orders %}
                                        {% if total_notifications > 0 %}
                                            <span class="badge rounded-pill badge-secondary">{{ total_notifications }}</span>
                                        {% endif %}
                                    {% endwith %}
                                {% endwith %}
                            </div>
                            <div class="onhover-show-div notification-dropdown">
                                <div class="card mb-0">
                                    <div class="card-header">
                                        <div class="common-space">
                                            <h4 class="text-start f-w-600">Notifications</h4>
                                            <div><small class="text-muted">Summary</small></div>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Today's Visitors
                                                <span class="badge bg-success rounded-pill">{{ today_visitors|default:"0" }}</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Low Stock Items
                                                <span class="badge bg-danger rounded-pill">{{ low_stock_items|default:"0" }}</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Overdue Orders
                                                <span class="badge bg-warning rounded-pill">{{ overdue_orders|default:"0" }}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </li>
                        
                        <!-- Profile -->
                        <li class="profile-nav onhover-dropdown">
                            <div class="media profile-media">
                                {% if user.profile.photo %}
                                    <img class="b-r-10" src="{{ user.profile.photo.url }}" alt="{{ user.get_full_name|default:user.username }}">
                                {% else %}
                                    <div class="avatar-placeholder b-r-10" style="width: 40px; height: 40px; background-color: #f0f0f0; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 18px;">{{ user.get_full_name|default:user.username|first|upper }}</span>
                                    </div>
                                {% endif %}
                                <div class="media-body d-xxl-block d-none box-col-none">
                                    <div class="d-flex align-items-center gap-2">
                                        <span>{{ user.get_full_name|default:user.username }}</span>
                                        <i class="middle fa fa-angle-down"></i>
                                    </div>
                                    <p class="mb-0 font-roboto">
                                        {% if user.is_superuser %}Admin{% elif user.is_staff %}Staff{% else %}User{% endif %}
                                    </p>
                                </div>
                            </div>
                            <ul class="profile-dropdown onhover-show-div">
                                <li>
                                    <a href="{% url 'tracker:profile' %}">
                                        <i data-feather="user"></i>
                                        <span>My Profile</span>
                                    </a>
                                </li>
                                <li>
                                    <form action="{% url 'tracker:logout' %}" method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <button type="submit" style="background: none; border: none; color: inherit; text-decoration: none; cursor: pointer; width: 100%; text-align: left; padding: 0;">
                                            <i data-feather="log-out"></i>
                                            <span>Logout</span>
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Page Header Ends -->
        
        <!-- Page Body Start -->
        <div class="page-body-wrapper">
            <!-- Page Sidebar Start -->
            <div class="sidebar-wrapper" data-layout="stroke-svg">
                <div>
                    <div class="logo-wrapper">
                        <a href="{% url 'tracker:dashboard' %}">
                            <img class="img-fluid" src="{% static 'assets/images/logo/logo.png' %}" alt="">
                        </a>
                        <div class="back-btn">
                            <i class="fa fa-angle-left"></i>
                        </div>
                        <div class="toggle-sidebar">
                            <i class="status_toggle middle sidebar-toggle" data-feather="grid"></i>
                        </div>
                    </div>
                    <div class="logo-icon-wrapper">
                        <a href="{% url 'tracker:dashboard' %}">
                            <img class="img-fluid" src="{% static 'assets/images/logo/logo-icon.png' %}" alt="">
                        </a>
                    </div>
                    <nav class="sidebar-main">
                        <div class="left-arrow" id="left-arrow">
                            <i data-feather="arrow-left"></i>
                        </div>
                        <div id="sidebar-menu">
                            <ul class="sidebar-links" id="simple-bar">
                                <li class="back-btn">
                                    <a href="{% url 'tracker:dashboard' %}">
                                        <img class="img-fluid" src="{% static 'assets/images/logo/logo-icon.png' %}" alt="">
                                    </a>
                                    <div class="mobile-back text-end">
                                        <span>Back</span>
                                        <i class="fa fa-angle-right ps-2" aria-hidden="true"></i>
                                    </div>
                                </li>
                                {% include 'tracker/sidebar_links.html' %}
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>

            <!-- Page Right Body Start -->
            <div class="page-body">
                <div class="container-fluid">
                    <div class="page-title">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h4 class="mb-0">{% block page_heading %}{% endblock %}</h4>
                            </div>
                            <div class="col-md-6 text-md-end mt-2 mt-md-0">
                                {% block page_actions %}{% endblock %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container-fluid">
                    {% block content %}{% endblock %}
                </div>
            </div>
            <!-- Page Right Body End -->
        </div>
        <!-- Page Body End -->

        <!-- Footer Start -->
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6 footer-copyright">&copy; {{ now|date:"Y" }} POS Tracker</div>
                    <div class="col-md-6 text-md-end">Made with <i class="fa fa-heart text-danger"></i></div>
                </div>
            </div>
        </footer>
        <!-- Footer End -->
    </div>

    <!-- Scripts -->
    <script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/feather.min.js' %}"></script>
    <script src="{% static 'assets/js/script.js' %}"></script>

    {% block extra_js %}{% endblock %}
</body>
</html>
